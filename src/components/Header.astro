---
// Fixed site header with responsive menu.
const currentPath = Astro.url.pathname;
function isActive(href: string): boolean {
  if (href === '/') return currentPath === '/';
  return currentPath.startsWith(href);
}
---
<header class="fixed inset-x-0 top-0 z-50 bg-brand-light/70 backdrop-blur-xl border-b border-edge/20 shadow-[0_1px_20px_rgba(0,0,0,0.4)]">
  <div class="mx-auto flex h-16 max-w-6xl items-center justify-between px-6">
    <a href="/" class="flex items-center gap-2.5 group">
      <img
        src="/img/mauiverse-logo-transparent.png"
        alt="MAUIverse"
        width="30"
        height="30"
        class="h-[30px] w-[30px] transition-transform duration-200 group-hover:scale-110"
        loading="eager"
        decoding="async"
      />
      <span class="font-header text-brand-dark text-base font-bold tracking-tight">
        MAUIverse
      </span>
    </a>

    <nav class="hidden items-center md:flex" aria-label="Primary">
      <div class="flex items-center gap-0.5 rounded-full border border-edge/30 bg-surface/40 backdrop-blur-xl px-1.5 py-1">
        <a href="/community-feed/" class:list={['nav-pill', { 'nav-pill-active': isActive('/community-feed/') }]}>Feed</a>
        <a href="/community-standup/" class:list={['nav-pill', { 'nav-pill-active': isActive('/community-standup/') }]}>Standup</a>
        <a href="/toolkit-standup/" class:list={['nav-pill', { 'nav-pill-active': isActive('/toolkit-standup/') }]}>Toolkit</a>
        <a href="/built-with-maui/" class:list={['nav-pill', { 'nav-pill-active': isActive('/built-with-maui/') }]}>Built with MAUI</a>
        <a href="/newsletter" class:list={['nav-pill', { 'nav-pill-active': isActive('/newsletter') }]}>Newsletter</a>
      </div>
      <a href="/discord/" class="ml-4 inline-flex items-center gap-1.5 rounded-full bg-brand-extra/90 backdrop-blur-sm px-5 py-2 text-sm font-semibold text-white transition-all duration-200 hover:bg-brand-extra hover:shadow-[0_0_20px_rgba(147,85,255,0.3)]">
        <i class="fa-brands fa-discord text-xs" aria-hidden="true"></i>
        Discord
      </a>
    </nav>

    <button
      id="mobile-menu-button"
      type="button"
      class="inline-flex items-center justify-center rounded-full p-2.5 text-muted hover:text-brand-dark focus:outline-none focus:ring-2 focus:ring-brand/40 md:hidden"
      aria-label="Open menu"
      aria-controls="mobile-menu"
      aria-expanded="false"
    >
      <i class="fa-solid fa-bars h-5 w-5" aria-hidden="true"></i>
    </button>
  </div>
</header>

<div
  id="mobile-menu"
  class="fixed inset-x-0 top-16 z-40 hidden bg-brand-light/95 backdrop-blur-xl border-b border-edge/30 md:hidden"
>
  <nav class="mx-auto max-w-6xl px-6 py-4" aria-label="Mobile Primary">
    <div class="flex flex-col gap-1">
      <a href="/community-feed/" class="rounded-lg px-4 py-2.5 text-sm font-medium text-muted transition-colors hover:text-brand-dark hover:bg-surface/50">
        Community Feed
      </a>
      <a href="/community-standup/" class="rounded-lg px-4 py-2.5 text-sm font-medium text-muted transition-colors hover:text-brand-dark hover:bg-surface/50">
        Community Standup
      </a>
      <a href="/toolkit-standup/" class="rounded-lg px-4 py-2.5 text-sm font-medium text-muted transition-colors hover:text-brand-dark hover:bg-surface/50">
        Toolkit Standup
      </a>
      <a href="/built-with-maui/" class="rounded-lg px-4 py-2.5 text-sm font-medium text-muted transition-colors hover:text-brand-dark hover:bg-surface/50">
        Built with MAUI
      </a>
      <a href="/newsletter" class="rounded-lg px-4 py-2.5 text-sm font-medium text-muted transition-colors hover:text-brand-dark hover:bg-surface/50">
        Newsletter
      </a>
      <div class="mt-2 pt-2 border-t border-edge/30">
        <a href="/discord/" class="flex items-center gap-2 rounded-lg px-4 py-2.5 text-sm font-semibold text-brand transition-colors hover:text-brand-dark">
          <i class="fa-brands fa-discord" aria-hidden="true"></i>
          Join Discord
        </a>
      </div>
    </div>
  </nav>
</div>

<script>
  (() => {
    const button = document.getElementById('mobile-menu-button');
    const menu = document.getElementById('mobile-menu');
    if (!(button instanceof HTMLButtonElement) || !(menu instanceof HTMLElement)) return;

    const setOpen = (open: boolean) => {
      menu.classList.toggle('hidden', !open);
      button.setAttribute('aria-expanded', String(open));
      button.setAttribute('aria-label', open ? 'Close menu' : 'Open menu');
    };

    button.addEventListener('click', () => {
      const isOpen = !menu.classList.contains('hidden');
      setOpen(!isOpen);
    });

    menu.addEventListener('click', (e) => {
      const target = e.target;
      if (target instanceof HTMLAnchorElement) setOpen(false);
    });

    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') setOpen(false);
    });

    window.addEventListener('resize', () => {
      if (window.matchMedia('(min-width: 768px)').matches) setOpen(false);
    });
  })();
</script>
