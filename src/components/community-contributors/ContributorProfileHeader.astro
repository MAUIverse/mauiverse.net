---
import { getCollection } from 'astro:content';
import {
  getAuthorImageSrc,
  getAuthorGitHubUrl,
  isMauiContributor,
  isMauiToolkitContributor,
  isSyncfusionMauiToolkitContributor,
  isSameAuthorKey,
} from '../../data/authors';

interface Props {
  githubUsername: string;
  displayName: string;
}

const { githubUsername, displayName } = Astro.props;
const githubUrl = getAuthorGitHubUrl(githubUsername);
const isMauiContributorProfile = isMauiContributor(githubUsername);
const isMauiToolkitContributorProfile = isMauiToolkitContributor(githubUsername);
const isSyncfusionMauiToolkitContributorProfile = isSyncfusionMauiToolkitContributor(githubUsername);
const mauiRepoUrl = 'https://github.com/dotnet/maui';
const mauiToolkitRepoUrl = 'https://github.com/CommunityToolkit/Maui';
const syncfusionMauiToolkitRepoUrl = 'https://github.com/syncfusion/maui-toolkit';
const contributionBadgeClass =
  'mb-2 inline-flex items-center rounded-full border border-edge bg-surface px-3 py-1 text-xs font-semibold uppercase tracking-wide text-brand-dark transition-colors hover:bg-edge hover:text-brand-extraDark';

const contributorProfile = (await getCollection('community-contributors')).find((entry) =>
  isSameAuthorKey(entry.data.gitHubUsername, githubUsername)
);

const hasLink = (value?: string) => Boolean(value && value.trim().length > 0);

const profileLinks = [
  githubUrl ? { label: 'GitHub', href: githubUrl, icon: 'github' } : null,
  hasLink(contributorProfile?.data.bskyUrl)
    ? { label: 'Bluesky', href: contributorProfile!.data.bskyUrl!, icon: 'bsky' }
    : null,
  hasLink(contributorProfile?.data.twitterUrl)
    ? { label: 'Twitter', href: contributorProfile!.data.twitterUrl!, icon: 'twitter' }
    : null,
  hasLink(contributorProfile?.data.instagramUrl)
    ? { label: 'Instagram', href: contributorProfile!.data.instagramUrl!, icon: 'instagram' }
    : null,
  hasLink(contributorProfile?.data.linkedInUrl)
    ? { label: 'LinkedIn', href: contributorProfile!.data.linkedInUrl!, icon: 'linkedin' }
    : null,
  hasLink(contributorProfile?.data.youTubeUrl)
    ? { label: 'YouTube', href: contributorProfile!.data.youTubeUrl!, icon: 'youtube' }
    : null,
  hasLink(contributorProfile?.data.tikTokUrl)
    ? { label: 'TikTok', href: contributorProfile!.data.tikTokUrl!, icon: 'tiktok' }
    : null,
  hasLink(contributorProfile?.data.blogUrl)
    ? { label: 'Blog', href: contributorProfile!.data.blogUrl!, icon: 'blog' }
    : null,
  hasLink(contributorProfile?.data.podcastWebsiteUrl)
    ? {
        label: 'Podcast',
        href: contributorProfile!.data.podcastWebsiteUrl!,
        icon: 'podcast',
      }
    : null,
  hasLink(contributorProfile?.data.twitchProfileUrl)
    ? { label: 'Twitch', href: contributorProfile!.data.twitchProfileUrl!, icon: 'twitch' }
    : null,
].filter((link): link is { label: string; href: string; icon: string } => Boolean(link));
---

<header class="mb-10 rounded-lg border border-edge bg-surface p-8 shadow-sm">
  <div class="flex flex-col items-center gap-5 text-center sm:flex-row sm:text-left">
    <img
      src={getAuthorImageSrc(githubUsername, 320)}
      alt={`${displayName} profile picture`}
      width="128"
      height="128"
      class="h-32 w-32 rounded-full"
      loading="lazy"
    />
    <div>
      <p class="mb-2 text-sm font-semibold uppercase tracking-wide text-muted-light">
        Community Contributor
      </p>
      {isMauiContributorProfile && (
        <a
          href={mauiRepoUrl}
          target="_blank"
          rel="noopener noreferrer"
          class={contributionBadgeClass}
        >
          MAUI Contributor
        </a>
      )}
      {isMauiToolkitContributorProfile && (
        <a
          href={mauiToolkitRepoUrl}
          target="_blank"
          rel="noopener noreferrer"
          class={contributionBadgeClass}
        >
          Community Toolkit Contributor
        </a>
      )}
      {isSyncfusionMauiToolkitContributorProfile && (
        <a
          href={syncfusionMauiToolkitRepoUrl}
          target="_blank"
          rel="noopener noreferrer"
          class={contributionBadgeClass}
        >
          Syncfusion Toolkit Contributor
        </a>
      )}
      <h1 class="mb-3 text-3xl font-header font-bold text-brand-dark">
        {displayName}
      </h1>
      {githubUrl ? (
        <a
          href={githubUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="text-base font-medium text-brand hover:underline"
        >
          {displayName} on GitHub
        </a>
      ) : (
        <span class="text-base text-muted-light">{displayName}</span>
      )}

      {profileLinks.length > 0 && (
        <div class="mt-4 flex flex-wrap items-center justify-center gap-3 sm:justify-start" aria-label="Profile links">
          {profileLinks.map((link) => (
            <a
              href={link.href}
              target="_blank"
              rel="noopener noreferrer"
              aria-label={link.label}
              title={link.label}
              class="inline-flex h-9 w-9 items-center justify-center rounded-full border border-edge bg-surface text-brand transition hover:bg-brand hover:text-white"
            >
              {link.icon === 'github' && (
                <svg viewBox="0 0 24 24" aria-hidden="true" class="h-5 w-5 fill-current">
                  <path d="M12 1.5a10.5 10.5 0 0 0-3.32 20.47c.53.1.72-.23.72-.5v-1.77c-2.93.64-3.55-1.24-3.55-1.24a2.79 2.79 0 0 0-1.17-1.54c-.95-.65.07-.64.07-.64a2.2 2.2 0 0 1 1.6 1.07 2.23 2.23 0 0 0 3.05.87 2.24 2.24 0 0 1 .66-1.4c-2.34-.27-4.8-1.17-4.8-5.2a4.08 4.08 0 0 1 1.09-2.84 3.8 3.8 0 0 1 .1-2.8s.88-.28 2.89 1.08a9.98 9.98 0 0 1 5.26 0c2-1.36 2.88-1.08 2.88-1.08a3.8 3.8 0 0 1 .1 2.8 4.08 4.08 0 0 1 1.09 2.84c0 4.04-2.46 4.92-4.81 5.18a2.5 2.5 0 0 1 .7 1.95v2.88c0 .27.19.6.73.5A10.5 10.5 0 0 0 12 1.5Z" />
                </svg>
              )}
              {link.icon === 'bsky' && (
                <svg viewBox="0 0 24 24" aria-hidden="true" class="h-5 w-5 fill-current">
                  <path d="M5.8 4.2C8 5.8 10.4 9 12 12.2c1.6-3.2 4-6.4 6.2-8 1.6-1.1 4.2-2 4.2.9 0 .6-.4 5.1-.7 5.8-.8 2.5-3.6 3.1-6.1 2.7 4.4.8 5.5 3.5 3.1 6.2-4.6 5.2-6.6-1.3-7.1-3-.1-.3-.1-.4-.3-.4s-.2.1-.3.4c-.5 1.7-2.5 8.2-7.1 3-2.4-2.7-1.3-5.4 3.1-6.2-2.5.4-5.3-.2-6.1-2.7-.3-.7-.7-5.2-.7-5.8 0-2.9 2.6-2 4.2-.9Z" />
                </svg>
              )}
              {link.icon === 'twitter' && (
                <svg viewBox="0 0 24 24" aria-hidden="true" class="h-5 w-5 fill-current">
                  <path d="M18.9 2H22l-6.8 7.8L23.2 22h-6.2l-4.9-6.9L6 22H2.8l7.2-8.3L.8 2H7l4.4 6.2L18.9 2Zm-1.1 18h1.7L6 3.9H4.2L17.8 20Z" />
                </svg>
              )}
              {link.icon === 'instagram' && (
                <svg viewBox="0 0 24 24" aria-hidden="true" class="h-5 w-5 fill-current">
                  <path d="M7.8 2h8.4A5.8 5.8 0 0 1 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8A5.8 5.8 0 0 1 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2Zm-.2 2A3.6 3.6 0 0 0 4 7.6v8.8A3.6 3.6 0 0 0 7.6 20h8.8a3.6 3.6 0 0 0 3.6-3.6V7.6A3.6 3.6 0 0 0 16.4 4H7.6Zm9.4 1.5a1.3 1.3 0 1 1 0 2.6 1.3 1.3 0 0 1 0-2.6ZM12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10Zm0 2a3 3 0 1 0 0 6 3 3 0 0 0 0-6Z" />
                </svg>
              )}
              {link.icon === 'linkedin' && (
                <svg viewBox="0 0 24 24" aria-hidden="true" class="h-5 w-5 fill-current">
                  <path d="M5.3 8.2H2.1V22h3.2V8.2ZM3.7 2A1.9 1.9 0 1 0 3.8 6a1.9 1.9 0 0 0-.1-4ZM22 13.9c0-4.2-2.2-6.2-5.2-6.2-2.4 0-3.5 1.3-4.1 2.3V8.2H9.5c0 1.2 0 13.8 0 13.8h3.2v-7.7c0-.4 0-.8.1-1.1.3-.8 1-1.6 2.2-1.6 1.6 0 2.3 1.2 2.3 3V22H22v-8.1Z" />
                </svg>
              )}
              {link.icon === 'youtube' && (
                <svg viewBox="0 0 24 24" aria-hidden="true" class="h-5 w-5 fill-current">
                  <path d="M23 8.3a3.4 3.4 0 0 0-2.4-2.4C18.5 5.3 12 5.3 12 5.3s-6.5 0-8.6.6A3.4 3.4 0 0 0 1 8.3a35 35 0 0 0-.6 3.7 35 35 0 0 0 .6 3.7 3.4 3.4 0 0 0 2.4 2.4c2.1.6 8.6.6 8.6.6s6.5 0 8.6-.6a3.4 3.4 0 0 0 2.4-2.4 35 35 0 0 0 .6-3.7 35 35 0 0 0-.6-3.7ZM9.8 15.3V8.7l5.7 3.3-5.7 3.3Z" />
                </svg>
              )}
              {link.icon === 'tiktok' && (
                <svg viewBox="0 0 24 24" aria-hidden="true" class="h-5 w-5 fill-current">
                  <path d="M14.8 2h2.7a4.8 4.8 0 0 0 4 4.1v2.9a7.6 7.6 0 0 1-4-.9v7.2A6.3 6.3 0 1 1 11.2 9v3a3.3 3.3 0 1 0 3.6 3.3V2Z" />
                </svg>
              )}
              {link.icon === 'blog' && (
                <svg viewBox="0 0 24 24" aria-hidden="true" class="h-5 w-5 fill-current">
                  <path d="M4 4h16v16H4V4Zm2 2v2h12V6H6Zm0 5v2h8v-2H6Zm0 5v2h5v-2H6Z" />
                </svg>
              )}
              {link.icon === 'podcast' && (
                <svg viewBox="0 0 24 24" aria-hidden="true" class="h-5 w-5 fill-current">
                  <path d="M12 3a7 7 0 0 0-3.5 13v2.5a3.5 3.5 0 1 0 7 0V16A7 7 0 0 0 12 3Zm0 2a5 5 0 0 1 2.5 9.3l-1 .6V18.5a1.5 1.5 0 1 1-3 0v-3.6l-1-.6A5 5 0 0 1 12 5Zm0 2.5A2.5 2.5 0 0 0 10.8 12v2.2a1.2 1.2 0 1 0 2.4 0V12A2.5 2.5 0 0 0 12 7.5Z" />
                </svg>
              )}
              {link.icon === 'twitch' && (
                <svg viewBox="0 0 24 24" aria-hidden="true" class="h-5 w-5 fill-current">
                  <path d="M3 2h18v12l-4 4h-4l-2 2H8v-2H3V2Zm2 2v10h4v2l2-2h4l3-3V4H5Zm5 2h2v5h-2V6Zm5 0h2v5h-2V6Z" />
                </svg>
              )}
            </a>
          ))}
        </div>
      )}
    </div>
  </div>
</header>
