---
import BaseLayout from '../../layouts/BaseLayout.astro';
import LivestreamCountdown from '../../components/LivestreamCountdown.astro';
import FeedEntries from '../../components/community-feed/FeedEntries.astro';
import Pagination from '../../components/community-feed/Pagination.astro';
import StandupAboutCard from '../../components/standup/StandupAboutCard.astro';
import { getCollection } from 'astro:content';
import { paginateEntries } from '../../utils/pagination';

const standupEntries = (await getCollection('community-feed'))
  .filter((e) => e.data.isStandup)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const pageSize = 8;
const { pages, totalPages } = paginateEntries(standupEntries, pageSize);
const pageEntries = pages[0]?.entries ?? [];
---

<BaseLayout
  title="Community Standup"
  description=".NET MAUI Community Toolkit monthly standup â€” live on YouTube every 1st Thursday."
>
  <div class="min-h-screen">
    <div class="container mx-auto max-w-4xl px-4 py-16 md:py-24 space-y-16 md:space-y-20">
      <!-- Countdown Hero -->
      <section>
        <p class="text-brand font-bold mb-4 text-sm font-header uppercase tracking-wide text-center">
          Community Standup
        </p>
        <LivestreamCountdown variant="full" showYouTubeEmbed={true} />
      </section>

      <!-- About -->
      <StandupAboutCard
        items={[
          { label: 'Frequency', value: '1st Thursday of every month' },
          { label: 'Time', value: '11:00 AM PT / 2:00 PM ET / 7:00 PM UTC' },
          { label: 'YouTube', value: '.NET YouTube Channel', href: 'https://www.youtube.com/@dotnet' },
          { label: 'Twitch', value: 'Visual Studio on Twitch', href: 'https://www.twitch.tv/visualstudio' },
          { label: 'Content', value: 'Project updates, Q&A, community contributions', spanTwoCols: true },
        ]}
      >
        The <strong class="text-brand-dark">.NET MAUI Community monthly standup</strong> is
        a 1-hour session live-streamed on the .NET YouTube channel. Each standup covers
        toolkit updates, community contributions, and an open Q&amp;A.
      </StandupAboutCard>

      <!-- Past Standups -->
      {pageEntries.length > 0 && (
        <section>
          <h2 class="text-brand-dark font-header font-bold text-xl mb-6">Past Standups</h2>
          <FeedEntries entries={pageEntries} showAuthor={false} actionLabel="Watch" />
          <Pagination currentPage={1} totalPages={totalPages} basePath="/community-standup" />
        </section>
      )}
    </div>
  </div>
</BaseLayout>
