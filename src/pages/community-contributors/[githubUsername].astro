---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import FeedEntries from '../../components/community-feed/FeedEntries.astro';
import {
  getAuthorKeys,
  getAuthorDisplayName,
  getAuthorImageSrc,
  getAuthorGitHubUrl,
  isSameAuthorKey,
} from '../../data/authors';

export async function getStaticPaths() {
  return getAuthorKeys().map((githubUsername) => ({
    params: { githubUsername },
    props: { githubUsername, displayName: getAuthorDisplayName(githubUsername) },
  }));
}

const { githubUsername, displayName } = Astro.props;
const githubUrl = getAuthorGitHubUrl(githubUsername);

const contributorEntries = (await getCollection('community-feed'))
  .filter((entry) => entry.data.author && isSameAuthorKey(entry.data.author, githubUsername))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout
  title={`${displayName} | Community Contributors | MAUIverse`}
  description={`Community Feed contributions from ${displayName}.`}
>
  <style is:global>
    html,
    body {
      height: auto;
      overflow: auto;
    }
  </style>

  <section class="min-h-screen px-0 py-24">
    <div class="container mx-auto max-w-4xl px-4">
      <a href="/community-contributors/" class="mb-6 inline-block text-sm font-medium text-brand hover:underline">
        ‚Üê Back to Community Contributors
      </a>

      <header class="mb-10 rounded-lg border border-edge bg-surface p-8 shadow-sm">
        <div class="flex flex-col items-center gap-5 text-center sm:flex-row sm:text-left">
          <img
            src={getAuthorImageSrc(githubUsername, 320)}
            alt={`${displayName} profile picture`}
            width="128"
            height="128"
            class="h-32 w-32 rounded-full"
            loading="lazy"
          />
          <div>
            <p class="mb-2 text-sm font-semibold uppercase tracking-wide text-muted-light">
              Community Contributor
            </p>
            <h1 class="mb-3 text-3xl font-header font-bold text-brand-dark">
              {displayName}
            </h1>
            {githubUrl ? (
              <a
                href={githubUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="text-base font-medium text-brand hover:underline"
              >
                {displayName} on GitHub
              </a>
            ) : (
              <span class="text-base text-muted-light">{displayName}</span>
            )}
          </div>
        </div>
      </header>

      <section aria-labelledby="contributor-feed-heading">
        <h2 id="contributor-feed-heading" class="mb-6 text-2xl font-header font-bold text-brand-dark">
          Community Feed Contributions
        </h2>
        {contributorEntries.length > 0 ? (
          <FeedEntries entries={contributorEntries} />
        ) : (
          <p class="rounded-lg border border-dashed border-edge bg-surface p-6 text-muted-light">
            No Community Feed entries are available yet for this contributor.
          </p>
        )}
      </section>
    </div>
  </section>
</BaseLayout>
